<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Clone Step 1: Template &amp; Upload</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;family=Noto+Sans+SC:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "lab-bg": "#0D1117",
                        "lab-border": "#30363D",
                        "lab-blue": "#00A3FF",
                        "lab-green": "#A6FF00",
                        "lab-card": "#161B22",
                        "lab-muted": "#8B949E",
                        "background-light": "#FFFFFF",
                        "background-dark": "#0D1117",
                        "primary": "#00A3FF"
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "sans": ["Space Grotesk", "Noto Sans SC", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Space Grotesk', 'Noto Sans SC', sans-serif;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 h-screen overflow-hidden flex flex-col">
    <!-- Top Navigation (Fixed Height: h-16) -->
    <header class="border-b border-lab-border bg-lab-bg/95 backdrop-blur-sm z-50 shrink-0 h-16">
        <div class="max-w-[1400px] mx-auto px-8 h-full flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="w-8 h-8 flex items-center justify-center bg-lab-blue/10 rounded border border-lab-blue/30">
                    <img src="/static/mohen.svg" class="w-5 h-5" alt="MoHen Logo" />
                </div>
                <div class="flex flex-col leading-none">
                    <h1 class="text-[11px] font-black tracking-[0.25em] text-white uppercase">Handwriting Lab</h1>
                    <span class="text-[9px] font-bold text-lab-blue tracking-widest uppercase">Version 1.2</span>
                </div>
            </div>
            <div class="flex items-center h-full gap-8">
                <nav class="flex h-full">
                    <a class="px-6 flex items-center text-[11px] font-bold uppercase tracking-[0.2em] text-lab-blue border-b-2 border-lab-blue h-full" href="/">Clone</a>
                    <a class="px-6 flex items-center text-[11px] font-bold uppercase tracking-[0.2em] text-lab-muted hover:text-white transition-colors h-full" href="/generate">Generate</a>
                </nav>
                <div class="flex items-center gap-5 border-l border-lab-border pl-8">
                    <div class="w-8 h-8 rounded border border-lab-border bg-lab-card flex items-center justify-center">
                        <span class="material-symbols-outlined text-sm text-lab-muted">person</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Steps Navigation (Fixed Height: h-12) -->
    <div class="bg-lab-card/30 border-b border-lab-border shrink-0 h-12">
        <div class="max-w-[1400px] mx-auto px-8 h-full flex items-center gap-12">
            <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-[0.15em] text-lab-blue">
                <span class="w-5 h-5 flex items-center justify-center border border-lab-blue rounded-full text-[9px] leading-none">1</span>
                PREPARE
            </div>
            <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-[0.15em] text-lab-muted">
                <span class="w-5 h-5 flex items-center justify-center border border-lab-border rounded-full text-[9px] leading-none">2</span>
                REFINE
            </div>
            <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-[0.15em] text-lab-muted">
                <span class="w-5 h-5 flex items-center justify-center border border-lab-border rounded-full text-[9px] leading-none">3</span>
                TRAINING
            </div>
        </div>
    </div>

    <!-- Main Content (Flex-1 to fill remaining height) -->
    <main class="flex-1 max-w-[1400px] mx-auto w-full px-8 py-6 flex flex-col min-h-0">
        
        <!-- Header (Split Layout) -->
        <div class="flex items-end justify-between mb-6 pb-6 border-b border-lab-border/30 shrink-0">
            <div class="flex-1 pr-12 border-r border-lab-border/30">
                <div class="flex items-center gap-2 mb-2">
                    <div class="h-[1px] w-8 bg-lab-blue"></div>
                    <p class="text-lab-blue text-[10px] font-bold tracking-[0.4em] uppercase">PHASE 01: SOURCE ACQUISITION</p>
                </div>
                <h2 class="text-3xl font-bold text-white tracking-tight">Model Calibration</h2>
            </div>
            <div class="flex-1 pl-12 flex flex-col justify-end h-full">
                 <p class="text-lab-muted text-sm leading-relaxed">
                    Initialize the neural cloning sequence by providing high-fidelity spatial handwriting samples. 
                    Download the standardized template and submit your results below.
                </p>
            </div>
        </div>

        <!-- Two Cards (Flex-1) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 flex-1 min-h-0 items-start">
            <!-- Card 1 -->
            <div class="lab-card flex flex-col p-6 h-full max-h-[500px] overflow-hidden rounded-xl border border-lab-border bg-lab-card/50">
                <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                    <div class="flex items-start justify-between mb-6">
                        <div class="space-y-1">
                            <div class="text-[10px] font-bold text-lab-blue tracking-widest uppercase">STEP 01</div>
                            <h3 class="text-xl font-bold text-white uppercase tracking-wider">ACQUIRE TEMPLATE</h3>
                        </div>
                        <span class="material-symbols-outlined text-lab-blue/40 text-4xl">description</span>
                    </div>
                    <p class="text-xs text-lab-muted leading-relaxed mb-6">
                        Our vision transformer requires a specific spatial grid to accurately map character height, kerning, and baseline variance. Download the official calibration sheet.
                    </p>
                    <div class="space-y-3 mb-6">
                        <a href="/static/MoHen_Template_V1.pdf" download="MoHen_Template_V1.pdf" target="_blank" class="block bg-black/40 border border-lab-border p-3 flex items-center justify-between group hover:border-lab-blue/50 transition-colors cursor-pointer rounded-lg no-underline">
                            <div class="flex items-center gap-4">
                                <span class="material-symbols-outlined text-lab-blue">picture_as_pdf</span>
                                <div>
                                    <p class="text-xs font-bold text-white">MoHen_Template_V1.pdf</p>
                                    <p class="text-[10px] text-lab-muted uppercase tracking-tighter">Universal A4 â€¢ 300 DPI</p>
                                </div>
                            </div>
                            <span class="material-symbols-outlined text-lab-muted group-hover:text-lab-blue">download</span>
                        </a>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="p-3 border border-lab-border bg-black/20 rounded-lg">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="material-symbols-outlined text-sm text-lab-blue">print</span>
                                    <p class="text-[10px] font-bold text-white uppercase tracking-widest">ANALOG</p>
                                </div>
                                <p class="text-[10px] text-lab-muted leading-relaxed">Print, fill with gel pen, scan at high res.</p>
                            </div>
                            <div class="p-3 border border-lab-border bg-black/20 rounded-lg">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="material-symbols-outlined text-sm text-lab-blue">tablet</span>
                                    <p class="text-[10px] font-bold text-white uppercase tracking-widest">DIGITAL</p>
                                </div>
                                <p class="text-[10px] text-lab-muted leading-relaxed">Import to tablet, use pressure stylus.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="/static/MoHen_Template_V1.pdf" download="MoHen_Template_V1.pdf" target="_blank" class="w-full bg-white hover:bg-white/90 text-lab-bg font-black py-3 text-[11px] uppercase tracking-[0.25em] transition-all flex items-center justify-center gap-2 mt-4 rounded-lg shrink-0 no-underline cursor-pointer">
                    <span class="material-symbols-outlined text-sm">download</span>
                    Download PDF
                </a>
            </div>

            <!-- Card 2 -->
            <div class="lab-card flex flex-col p-6 h-full max-h-[500px] overflow-hidden rounded-xl border border-lab-border bg-lab-card/50">
                <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                    <div class="flex items-start justify-between mb-6">
                        <div class="space-y-1">
                            <div class="text-[10px] font-bold text-lab-blue tracking-widest uppercase">STEP 02</div>
                            <h3 class="text-xl font-bold text-white uppercase tracking-wider">SUBMIT SAMPLES</h3>
                        </div>
                        <span class="material-symbols-outlined text-lab-blue/40 text-4xl">upload_file</span>
                    </div>
                    <p class="text-xs text-lab-muted leading-relaxed mb-6">
                        Upload your completed template. Ensure the image is flat, well-lit, and the grid markers are clearly visible for the extraction engine.
                    </p>
                    <div id="dropzone" class="border border-dashed border-lab-border bg-black/40 hover:bg-lab-blue/5 hover:border-lab-blue/50 transition-all p-8 flex flex-col items-center justify-center cursor-pointer group mb-6 flex-1 min-h-[120px] rounded-lg">
                        <input type="file" id="fileInput" class="hidden" accept=".jpg,.jpeg,.png,.pdf" />
                        <div class="w-12 h-12 rounded-full bg-lab-bg border border-lab-border flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                            <span class="material-symbols-outlined text-lab-blue text-2xl">cloud_upload</span>
                        </div>
                        <p id="uploadText" class="text-[10px] font-bold text-white mb-1 uppercase tracking-[0.2em]">Drop source files</p>
                        <p id="uploadSubtext" class="text-[9px] text-lab-muted uppercase tracking-tighter">JPG, PNG, PDF up to 50MB</p>
                    </div>
                    <div class="p-3 border-l-2 border-lab-blue bg-lab-blue/5 mb-2 rounded-r-lg">
                        <div class="flex gap-3">
                            <span class="material-symbols-outlined text-lab-blue text-sm">info</span>
                            <div class="space-y-0.5">
                                <p class="text-[10px] font-black text-white uppercase tracking-widest">Quality Check</p>
                                <p class="text-[10px] text-lab-muted leading-relaxed">
                                    Avoid shadows and perspective tilt. For best results, use black ink and ensure the page is perfectly flat.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="next-btn" onclick="window.location.href='/step2'" class="w-full bg-gray-600 text-gray-400 font-black py-3 text-[11px] uppercase tracking-[0.25em] transition-all flex items-center justify-center gap-2 mt-4 rounded-lg shrink-0 cursor-not-allowed" disabled>
                    <span class="material-symbols-outlined text-sm">rocket_launch</span>
                    Upload to Proceed
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="flex items-center justify-between pt-2 shrink-0 border-t border-lab-border/30 mt-4">
            <div class="flex items-center gap-10">
                <div class="flex items-center gap-2">
                    <div class="w-1.5 h-1.5 bg-lab-green rounded-full shadow-[0_0_8px_#A6FF00]"></div>
                    <span class="text-[9px] font-bold uppercase tracking-[0.2em] text-white">Neural Core Active</span>
                </div>
                <div class="text-[9px] font-bold uppercase tracking-[0.2em] text-lab-muted flex items-center gap-2 hidden sm:flex">
                    <span class="material-symbols-outlined text-[14px]">memory</span>
                    GPU Clusters: [4/4] Nominal
                </div>
                <div class="text-[9px] font-bold uppercase tracking-[0.2em] text-lab-muted flex items-center gap-2 hidden sm:flex">
                    <span class="material-symbols-outlined text-[14px]">speed</span>
                    Bandwidth: 1.2 GB/s
                </div>
            </div>
            <div class="text-[9px] font-bold uppercase tracking-[0.3em] text-lab-muted/50 hidden sm:block">
                HS-LAB_PROTOCOL_V1.2 // SECURE_UPLINK
            </div>
        </div>
    </main>
    <script>
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const uploadText = document.getElementById('uploadText');
        const uploadSubtext = document.getElementById('uploadSubtext');
        const nextBtn = document.getElementById('next-btn');

        dropzone.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', handleFile);

        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('border-lab-blue');
        });

        dropzone.addEventListener('dragleave', () => {
            dropzone.classList.remove('border-lab-blue');
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('border-lab-blue');
            const files = e.dataTransfer.files;
            if (files.length) {
                fileInput.files = files;
                handleFile();
            }
        });

        function handleFile() {
            const file = fileInput.files[0];
            if (!file) return;

            uploadText.textContent = "Uploading...";
            
            const formData = new FormData();
            formData.append('file', file);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.filename) {
                    uploadText.textContent = "Uploaded: " + data.filename;
                    uploadSubtext.textContent = "Ready to Process";
                    dropzone.classList.add('border-lab-green', 'bg-lab-green/10');
                    dropzone.classList.remove('border-dashed');
                    
                    // Enable Next Button
                    nextBtn.disabled = false;
                    nextBtn.classList.remove('bg-gray-600', 'text-gray-400', 'cursor-not-allowed');
                    nextBtn.classList.add('bg-lab-green', 'hover:brightness-110', 'text-lab-bg');
                    nextBtn.innerHTML = '<span class="material-symbols-outlined text-sm">rocket_launch</span> Start Processing';
                } else {
                    uploadText.textContent = "Upload Failed";
                }
            })
            .catch(err => {
                console.error(err);
                uploadText.textContent = "Error";
            });
        }

        // Check training status and redirect if needed
        fetch('/api/training_status')
            .then(res => res.json())
            .then(data => {
                if (data.state === 'training' || data.state === 'preparing') {
                    window.location.href = '/step3';
                }
            });
    </script>
</body>
</html>